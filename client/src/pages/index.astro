---
import Layout from '../layouts/Layout.astro';
import Welcome from '../components/Welcome.tsx';
import PurposeList from '../components/PurposeList.tsx';
import Transactions from '../components/Transactions.tsx';
import Comparative from '../components/Comparative.tsx';
import AccumulatedList from '../components/AccumulatedList.tsx';
import { fetchAccumulated } from '../utils/fetchAccumulated'
import { fetchPurposes } from '../utils/fetchPurposes'
import { fetchTransactions } from '../utils/fetchTransactions'

export const prerender = false
const [acc, purposes, transactions] = await Promise.all([
  fetchAccumulated(), fetchPurposes(), fetchTransactions()
])

const totalAcc = acc.data.data.reduce((acc, current) => acc + Number(current.total) ,0)
console.log(transactions)
---

<Layout>
  <Welcome />

  <main class="p-4">
    <PurposeList client:load purposes = {purposes.data}/>

    <section class="grid grid-cols-2 gap-4">
      <Transactions client:only="react" transactions = {transactions.data}/>

      <div>
        <Comparative client:load accumulated = {totalAcc}/>
        <AccumulatedList client:load items = {acc.data}/>
      </div>
    </section>
  </main>
</Layout>
